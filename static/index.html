<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alternative CBD - Actualización de Stock</title>
    <meta name="description" content="Actualiza el stock desde archivos CSV con Alternative CBD">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="grain-overlay"></div>
    
    <div class="container">
        <header class="header">
            <img src="https://www.alternativecbd.es/wp-content/uploads/2marca-final-anternativeCBD-vertical-transparente-blanc800-min-300x244.png" 
                 alt="Alternative CBD Logo" 
                 class="logo"
                 id="logo">
            <nav class="nav-menu">
                <a href="/" class="nav-link active">Inicio</a>
                <a href="/holded" class="nav-link">Holded</a>
                <a href="/storage" class="nav-link">Cloud Storage</a>
            </nav>
        </header>

        <main class="main-content">
            <div class="upload-card">
                <h1 class="title">Actualización de Stock</h1>
                <p class="subtitle">Simula la actualización de stock desde un archivo CSV</p>

                <!-- Input Method Selection -->
                <div class="input-method-tabs">
                    <button class="method-tab active" id="tabGsUri" data-method="gs_uri">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 3C16.982 3 21 7.018 21 12C21 16.982 16.982 21 12 21C7.018 21 3 16.982 3 12C3 7.018 7.018 3 12 3Z" stroke="currentColor" stroke-width="2"/>
                            <path d="M7 10C7 8.343 9.239 7 12 7C14.761 7 17 8.343 17 10C17 11.657 14.761 13 12 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            <path d="M12 13V17" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        GCS URI
                    </button>
                    <button class="method-tab" id="tabFileUpload" data-method="file_upload">
                        <svg class="tab-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 15V3M12 3L8 7M12 3L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            <path d="M2 17L2.621 19.485C2.72915 19.9177 2.97882 20.3018 3.33033 20.5763C3.68184 20.8508 4.11501 20.9999 4.561 21H19.439C19.885 20.9999 20.3182 20.8508 20.6697 20.5763C21.0212 20.3018 21.2708 19.9177 21.379 19.485L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        Subir Archivo
                    </button>
                </div>

                <!-- GCS URI Input (Option 1) -->
                <div class="input-section" id="gsUriSection">
                    <label class="input-label" for="gsUriInput">URI del archivo en Google Cloud Storage</label>
                    <div class="uri-input-wrapper">
                        <span class="uri-prefix">gs://</span>
                        <input type="text" 
                               id="gsUriInput" 
                               class="uri-input" 
                               placeholder="alternativecbd-glop-reports/archivo.csv">
                    </div>
                    <p class="input-hint">Ejemplo: alternativecbd-glop-reports/ventas-murcia.csv</p>
                </div>

                <!-- File Upload (Option 2) -->
                <div class="input-section" id="fileUploadSection" style="display: none;">
                    <div class="upload-zone" id="uploadZone">
                        <input type="file" 
                               id="fileInput" 
                               accept=".csv" 
                               class="file-input">
                        
                        <div class="upload-icon-wrapper">
                            <svg class="upload-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 15V3M12 3L8 7M12 3L16 7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M2 17L2.621 19.485C2.72915 19.9177 2.97882 20.3018 3.33033 20.5763C3.68184 20.8508 4.11501 20.9999 4.561 21H19.439C19.885 20.9999 20.3182 20.8508 20.6697 20.5763C21.0212 20.3018 21.2708 19.9177 21.379 19.485L22 17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        
                        <p class="upload-text">
                            <span class="upload-text-main">Seleccionar archivo CSV</span>
                            <span class="upload-text-sub">o arrastrar aquí</span>
                        </p>
                    </div>

                    <div class="file-info" id="fileInfo" style="display: none;">
                        <div class="file-details">
                            <svg class="file-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <div class="file-text">
                                <p class="file-name" id="fileName"></p>
                                <p class="file-size" id="fileSize"></p>
                            </div>
                        </div>
                        <button class="remove-btn" id="removeBtn" type="button">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <p class="input-hint">El archivo se subirá a gs://alternativecbd-glop-reports/</p>
                </div>

                <!-- Simulate Button -->
                <button class="upload-btn" id="simulateBtn" disabled>
                    <span class="btn-text">Simular Actualización (Dry Run)</span>
                    <svg class="btn-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M22 4L12 14.01L9 11.01" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>

                <div class="dry-run-notice">
                    <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 16V12M12 8H12.01M22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span>Modo simulación activo: no se modificará la base de datos de Holded</span>
                </div>

                <div class="progress-container" id="progressContainer" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <p class="progress-text" id="progressText">0%</p>
                </div>

                <div class="status-message" id="statusMessage" style="display: none;"></div>

                <!-- Simulation Results Section -->
                <div class="simulation-section" id="simulationSection" style="display: none;">
                    <div class="data-header" id="simulationHeaderToggle">
                        <div class="data-header-left">
                            <h2 class="data-title">Resultados de Simulación</h2>
                            <button class="toggle-btn" id="toggleSimulationBtn" aria-label="Toggle simulation">
                                <svg class="chevron-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                        </div>
                        <button class="clear-btn" id="clearSimulationBtn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            Limpiar
                        </button>
                    </div>
                    <div class="table-collapsible-content" id="simulationContent">
                        <!-- Summary Stats -->
                        <div class="simulation-summary">
                            <div class="summary-item info-item">
                                <span class="summary-label">Procesados:</span>
                                <span class="summary-value" id="simProcessed">0</span>
                            </div>
                            <div class="summary-item success-item">
                                <span class="summary-label">Actualizados:</span>
                                <span class="summary-value" id="simUpdated">0</span>
                            </div>
                            <div class="summary-item error-item">
                                <span class="summary-label">Errores:</span>
                                <span class="summary-value" id="simErrors">0</span>
                            </div>
                        </div>

                        <!-- Updates Table -->
                        <div class="results-subsection" id="updatesSubsection" style="display: none;">
                            <h3 class="subsection-title">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 6L9 17L4 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Actualizaciones que se aplicarían
                            </h3>
                            <div class="table-container">
                                <table class="data-table simulation-table" id="updatesTable">
                                    <thead>
                                        <tr>
                                            <th>SKU</th>
                                            <th>Producto</th>
                                            <th>Almacén</th>
                                            <th class="numeric">Vendidas</th>
                                            <th class="numeric">Stock Actual</th>
                                            <th class="numeric">Stock Nuevo</th>
                                        </tr>
                                    </thead>
                                    <tbody id="updatesTableBody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Errors Table -->
                        <div class="results-subsection errors-subsection" id="errorsSubsection" style="display: none;">
                            <h3 class="subsection-title error-title">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                Errores encontrados
                            </h3>
                            <div class="table-container">
                                <table class="data-table errors-table" id="errorsTable">
                                    <thead>
                                        <tr>
                                            <th>Fila</th>
                                            <th>SKU</th>
                                            <th>Producto</th>
                                            <th>Terminal</th>
                                            <th>Unidades</th>
                                            <th>Error</th>
                                        </tr>
                                    </thead>
                                    <tbody id="errorsTableBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>© 2025 Alternative CBD. Todos los derechos reservados.</p>
        </footer>
    </div>

    <script src="/static/script.js"></script>
</body>
</html>
